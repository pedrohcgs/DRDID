<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Improved locally efficient doubly robust DiD estimator for the ATT, with panel data — drdid_imp_panel • DRDID</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Improved locally efficient doubly robust DiD estimator for the ATT, with panel data — drdid_imp_panel"><meta property="og:description" content="drdid_imp_panel is used to compute the locally efficient doubly robust estimators for the ATT
 in difference-in-differences (DiD) setups with panel data. The resulting estimator is also doubly robust
 for inference; see Section 3.1 of Sant'Anna and Zhao (2020)."><meta property="og:image" content="https://psantanna.com/DRDID/reference/figures/logo.png"><meta property="og:image:alt" content="Doubly Robust DiD Estimators"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@pedrohcgs"><meta name="twitter:site" content="@pedrohcgs"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DRDID</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fas fa-home fa-la"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/pedrohcgs/DRDID/" class="external-link">
    <span class="fab fa-github fa-la"></span>

  </a>
</li>
<li>
  <a href="http://twitter.com/pedrohcgs" class="external-link">
    <span class="fab fa-twitter fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Improved locally efficient doubly robust DiD estimator for the ATT, with panel data</h1>
    <small class="dont-index">Source: <a href="https://github.com/pedrohcgs/DRDID/blob/master/R/drdid_imp_panel.R" class="external-link"><code>R/drdid_imp_panel.R</code></a></small>
    <div class="hidden name"><code>drdid_imp_panel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>drdid_imp_panel</code> is used to compute the locally efficient doubly robust estimators for the ATT
 in difference-in-differences (DiD) setups with panel data. The resulting estimator is also doubly robust
 for inference; see Section 3.1 of Sant'Anna and Zhao (2020).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">drdid_imp_panel</span><span class="op">(</span></span>
<span>  <span class="va">y1</span>,</span>
<span>  <span class="va">y0</span>,</span>
<span>  <span class="va">D</span>,</span>
<span>  <span class="va">covariates</span>,</span>
<span>  i.weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  boot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  boot.type <span class="op">=</span> <span class="st">"weighted"</span>,</span>
<span>  nboot <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inffunc <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trim.level <span class="op">=</span> <span class="fl">0.995</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-y-">y1<a class="anchor" aria-label="anchor" href="#arg-y-"></a></dt>
<dd><p>An \(n\) x \(1\) vector of outcomes from the post-treatment period.</p></dd>


<dt id="arg-y-">y0<a class="anchor" aria-label="anchor" href="#arg-y-"></a></dt>
<dd><p>An \(n\) x \(1\) vector of outcomes from the pre-treatment period.</p></dd>


<dt id="arg-d">D<a class="anchor" aria-label="anchor" href="#arg-d"></a></dt>
<dd><p>An \(n\) x \(1\) vector of Group indicators (=1 if observation is treated in the post-treatment, =0 otherwise).</p></dd>


<dt id="arg-covariates">covariates<a class="anchor" aria-label="anchor" href="#arg-covariates"></a></dt>
<dd><p>An \(n\) x \(k\) matrix of covariates to be used in the propensity score and regression estimation. Please add a vector of constants if you want to include an intercept in the models.
If covariates = NULL, this leads to an unconditional DiD estimator.</p></dd>


<dt id="arg-i-weights">i.weights<a class="anchor" aria-label="anchor" href="#arg-i-weights"></a></dt>
<dd><p>An \(n\) x \(1\) vector of weights to be used. If NULL, then every observation has the same weights. The weights are normalized and therefore enforced to have mean 1 across all observations.</p></dd>


<dt id="arg-boot">boot<a class="anchor" aria-label="anchor" href="#arg-boot"></a></dt>
<dd><p>Logical argument to whether bootstrap should be used for inference. Default is FALSE.</p></dd>


<dt id="arg-boot-type">boot.type<a class="anchor" aria-label="anchor" href="#arg-boot-type"></a></dt>
<dd><p>Type of bootstrap to be performed (not relevant if <code>boot = FALSE</code>). Options are "weighted" and "multiplier".
If <code>boot = TRUE</code>, default is "weighted".</p></dd>


<dt id="arg-nboot">nboot<a class="anchor" aria-label="anchor" href="#arg-nboot"></a></dt>
<dd><p>Number of bootstrap repetitions (not relevant if <code>boot = FALSE</code>). Default is 999.</p></dd>


<dt id="arg-inffunc">inffunc<a class="anchor" aria-label="anchor" href="#arg-inffunc"></a></dt>
<dd><p>Logical argument to whether influence function should be returned. Default is FALSE.</p></dd>


<dt id="arg-trim-level">trim.level<a class="anchor" aria-label="anchor" href="#arg-trim-level"></a></dt>
<dd><p>The level of trimming for the propensity score. Default is 0.995.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list containing the following components:</p>
<dl><dt>ATT</dt>
<dd><p>The DiD point estimate.</p></dd>

 <dt>se</dt>
<dd><p>The DiD standard error.</p></dd>

 <dt>uci</dt>
<dd><p>The upper bound of the 95% CI for the ATT.</p></dd>

 <dt>lci</dt>
<dd><p>The lower bound of the 95% CI for the ATT</p></dd>

 <dt>boots</dt>
<dd><p>All Bootstrap draws of the ATT, in case bootstrap was used to conduct inference. Default is <code>NULL</code>.</p></dd>

 <dt>ps.flag</dt>
<dd><p>Convergence Flag for the propensity score estimation: =0 if <code>trust</code> algorithm converged,
   =1 if IPW algorithm converged (in case it was used), =2 if GLM logit estimator was used (i.e., if both <code>trust</code> and IPT
   did not converged).</p></dd>

 <dt>att.inf.func</dt>
<dd><p>Estimate of the influence function. Default is NULL</p></dd>

 <dt>call.param</dt>
<dd><p>The matched call.</p></dd>

 <dt>argu</dt>
<dd><p>Some arguments used (explicitly or not) in the call (panel = TRUE, estMethod = "imp", boot, boot.type, nboot, type="dr")</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The <code>drdid_imp_panel</code> function implements the locally efficient doubly robust difference-in-differences (DiD)
estimator for the average treatment effect on the treated (ATT) defined in equation (3.1)
in Sant'Anna and Zhao (2020). This estimator makes use of a logistic propensity score model for the probability
of being in the treated group, and of a linear regression model for the outcome evolution among the comparison units.</p>

<p>The nuisance parameters (propensity score and outcome regression parameters) are estimated using the methods
described in Sections 3.1 of Sant'Anna and Zhao (2020). In short, the propensity score parameters are estimated
using the inverse probability tilting estimator proposed by Graham, Pinto and Pinto (2012), and the outcome
regression coefficients are estimated using weighted least squares,where the weights depend on
the propensity score estimates; see Sant'Anna and Zhao (2020) for details.</p>

<p>The resulting estimator is not only locally efficient and doubly robust for the ATT,
but it is also doubly robust for inference; see Sant'Anna and Zhao (2020) for details.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p><cite>Graham, Bryan, Pinto, Cristine, and Egel, Daniel (2012),
"Inverse Probability Tilting for Moment Condition Models with Missing Data."
 Review of Economic Studies, vol. 79 (3), pp. 1053-1079, <a href="https://doi.org/10.1093/restud/rdr047" class="external-link">doi:10.1093/restud/rdr047</a>
</cite></p>

<p><cite>Sant'Anna, Pedro H. C. and Zhao, Jun. (2020),
"Doubly Robust Difference-in-Differences Estimators." Journal of Econometrics, Vol. 219 (1), pp. 101-122,
<a href="https://doi.org/10.1016/j.jeconom.2020.06.003" class="external-link">doi:10.1016/j.jeconom.2020.06.003</a>
</cite></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Form the Lalonde sample with CPS comparison group</span></span></span>
<span class="r-in"><span><span class="va">eval_lalonde_cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">nsw</span>, <span class="va">nsw</span><span class="op">$</span><span class="va">treated</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">nsw</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Further reduce sample to speed example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">unit_random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eval_lalonde_cps</span><span class="op">)</span>, <span class="fl">5000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">eval_lalonde_cps</span> <span class="op">&lt;-</span> <span class="va">eval_lalonde_cps</span><span class="op">[</span><span class="va">unit_random</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># Select some covariates</span></span></span>
<span class="r-in"><span><span class="va">covX</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">age</span>, <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">educ</span>,</span></span>
<span class="r-in"><span>                             <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">black</span>, <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">married</span>,</span></span>
<span class="r-in"><span>                             <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">nodegree</span>, <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">hisp</span>,</span></span>
<span class="r-in"><span>                             <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">re74</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Implement improved DR locally efficient DiD with panel data</span></span></span>
<span class="r-in"><span><span class="fu">drdid_imp_panel</span><span class="op">(</span>y1 <span class="op">=</span> <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">re78</span>, y0 <span class="op">=</span> <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">re75</span>,</span></span>
<span class="r-in"><span>                D <span class="op">=</span> <span class="va">eval_lalonde_cps</span><span class="op">$</span><span class="va">experimental</span>,</span></span>
<span class="r-in"><span>                covariates <span class="op">=</span> <span class="va">covX</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> drdid_imp_panel(y1 = eval_lalonde_cps$re78, y0 = eval_lalonde_cps$re75, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D = eval_lalonde_cps$experimental, covariates = covX)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Further improved locally efficient DR DID estimator for the ATT:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ATT     Std. Error  t value    Pr(&gt;|t|)  [95% Conf. Interval] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -615.2344   683.1528   -0.9006     0.3678   -1954.2139  723.7452 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimator based on panel data.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Outcome regression est. method: weighted least squares.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Propensity score est. method: inverse prob. tilting.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Analytical standard error.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  See Sant'Anna and Zhao (2020) for details.</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://psantanna.com" class="external-link">Pedro H. C. Sant’Anna</a>, Jun Zhao.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

